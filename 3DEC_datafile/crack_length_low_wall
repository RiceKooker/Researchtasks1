model new
model configure plugins
model large-strain off
block mech damp local 0.8
block create brick 0.0000000000 0.2500000000 0.0000000000 0.1250000000 0.0000000000 0.0675000000
block create brick 0.2500000000 0.5000000000 0.0000000000 0.1250000000 0.0000000000 0.0675000000
block create brick 0.5000000000 0.7500000000 0.0000000000 0.1250000000 0.0000000000 0.0675000000
block create brick 0.7500000000 1.0000000000 0.0000000000 0.1250000000 0.0000000000 0.0675000000
block create brick 0.0000000000 0.1250000000 0.0000000000 0.2500000000 0.0675000000 0.1350000000
block create brick 0.1250000000 0.1875000000 0.0000000000 0.2500000000 0.0675000000 0.1350000000
block create brick 0.1875000000 0.3125000000 0.0000000000 0.2500000000 0.0675000000 0.1350000000
block create brick 0.3125000000 0.4375000000 0.0000000000 0.2500000000 0.0675000000 0.1350000000
block create brick 0.4375000000 0.5625000000 0.0000000000 0.2500000000 0.0675000000 0.1350000000
block create brick 0.5625000000 0.6875000000 0.0000000000 0.2500000000 0.0675000000 0.1350000000
block create brick 0.6875000000 0.8125000000 0.0000000000 0.2500000000 0.0675000000 0.1350000000
block create brick 0.8125000000 0.8750000000 0.0000000000 0.2500000000 0.0675000000 0.1350000000
block create brick 0.8750000000 1.0000000000 0.0000000000 0.2500000000 0.0675000000 0.1350000000
block create brick 0.0000000000 0.2500000000 0.1250000000 0.2500000000 0.0000000000 0.0675000000
block create brick 0.2500000000 0.5000000000 0.1250000000 0.2500000000 0.0000000000 0.0675000000
block create brick 0.5000000000 0.7500000000 0.1250000000 0.2500000000 0.0000000000 0.0675000000
block create brick 0.7500000000 1.0000000000 0.1250000000 0.2500000000 0.0000000000 0.0675000000
block create brick 0.0000000000 0.2500000000 0.0000000000 0.1250000000 0.1350000000 0.2025000000
block create brick 0.2500000000 0.5000000000 0.0000000000 0.1250000000 0.1350000000 0.2025000000
block create brick 0.5000000000 0.7500000000 0.0000000000 0.1250000000 0.1350000000 0.2025000000
block create brick 0.7500000000 1.0000000000 0.0000000000 0.1250000000 0.1350000000 0.2025000000
block create brick 0.0000000000 0.1250000000 0.0000000000 0.2500000000 0.2025000000 0.2700000000
block create brick 0.1250000000 0.1875000000 0.0000000000 0.2500000000 0.2025000000 0.2700000000
block create brick 0.1875000000 0.3125000000 0.0000000000 0.2500000000 0.2025000000 0.2700000000
block create brick 0.3125000000 0.4375000000 0.0000000000 0.2500000000 0.2025000000 0.2700000000
block create brick 0.4375000000 0.5625000000 0.0000000000 0.2500000000 0.2025000000 0.2700000000
block create brick 0.5625000000 0.6875000000 0.0000000000 0.2500000000 0.2025000000 0.2700000000
block create brick 0.6875000000 0.8125000000 0.0000000000 0.2500000000 0.2025000000 0.2700000000
block create brick 0.8125000000 0.8750000000 0.0000000000 0.2500000000 0.2025000000 0.2700000000
block create brick 0.8750000000 1.0000000000 0.0000000000 0.2500000000 0.2025000000 0.2700000000
block create brick 0.0000000000 0.2500000000 0.1250000000 0.2500000000 0.1350000000 0.2025000000
block create brick 0.2500000000 0.5000000000 0.1250000000 0.2500000000 0.1350000000 0.2025000000
block create brick 0.5000000000 0.7500000000 0.1250000000 0.2500000000 0.1350000000 0.2025000000
block create brick 0.7500000000 1.0000000000 0.1250000000 0.2500000000 0.1350000000 0.2025000000
block create brick 0.0000000000 0.2500000000 0.0000000000 0.1250000000 0.2700000000 0.3375000000
block create brick 0.2500000000 0.5000000000 0.0000000000 0.1250000000 0.2700000000 0.3375000000
block create brick 0.5000000000 0.7500000000 0.0000000000 0.1250000000 0.2700000000 0.3375000000
block create brick 0.7500000000 1.0000000000 0.0000000000 0.1250000000 0.2700000000 0.3375000000
block create brick 0.0000000000 0.1250000000 0.0000000000 0.2500000000 0.3375000000 0.4050000000
block create brick 0.1250000000 0.1875000000 0.0000000000 0.2500000000 0.3375000000 0.4050000000
block create brick 0.1875000000 0.3125000000 0.0000000000 0.2500000000 0.3375000000 0.4050000000
block create brick 0.3125000000 0.4375000000 0.0000000000 0.2500000000 0.3375000000 0.4050000000
block create brick 0.4375000000 0.5625000000 0.0000000000 0.2500000000 0.3375000000 0.4050000000
block create brick 0.5625000000 0.6875000000 0.0000000000 0.2500000000 0.3375000000 0.4050000000
block create brick 0.6875000000 0.8125000000 0.0000000000 0.2500000000 0.3375000000 0.4050000000
block create brick 0.8125000000 0.8750000000 0.0000000000 0.2500000000 0.3375000000 0.4050000000
block create brick 0.8750000000 1.0000000000 0.0000000000 0.2500000000 0.3375000000 0.4050000000
block create brick 0.0000000000 0.2500000000 0.1250000000 0.2500000000 0.2700000000 0.3375000000
block create brick 0.2500000000 0.5000000000 0.1250000000 0.2500000000 0.2700000000 0.3375000000
block create brick 0.5000000000 0.7500000000 0.1250000000 0.2500000000 0.2700000000 0.3375000000
block create brick 0.7500000000 1.0000000000 0.1250000000 0.2500000000 0.2700000000 0.3375000000
block create brick 0.0000000000 0.2500000000 0.0000000000 0.1250000000 0.4050000000 0.4725000000
block create brick 0.2500000000 0.5000000000 0.0000000000 0.1250000000 0.4050000000 0.4725000000
block create brick 0.5000000000 0.7500000000 0.0000000000 0.1250000000 0.4050000000 0.4725000000
block create brick 0.7500000000 1.0000000000 0.0000000000 0.1250000000 0.4050000000 0.4725000000
block create brick 0.0000000000 0.1250000000 0.0000000000 0.2500000000 0.4725000000 0.5400000000
block create brick 0.1250000000 0.1875000000 0.0000000000 0.2500000000 0.4725000000 0.5400000000
block create brick 0.1875000000 0.3125000000 0.0000000000 0.2500000000 0.4725000000 0.5400000000
block create brick 0.3125000000 0.4375000000 0.0000000000 0.2500000000 0.4725000000 0.5400000000
block create brick 0.4375000000 0.5625000000 0.0000000000 0.2500000000 0.4725000000 0.5400000000
block create brick 0.5625000000 0.6875000000 0.0000000000 0.2500000000 0.4725000000 0.5400000000
block create brick 0.6875000000 0.8125000000 0.0000000000 0.2500000000 0.4725000000 0.5400000000
block create brick 0.8125000000 0.8750000000 0.0000000000 0.2500000000 0.4725000000 0.5400000000
block create brick 0.8750000000 1.0000000000 0.0000000000 0.2500000000 0.4725000000 0.5400000000
block create brick 0.0000000000 0.2500000000 0.1250000000 0.2500000000 0.4050000000 0.4725000000
block create brick 0.2500000000 0.5000000000 0.1250000000 0.2500000000 0.4050000000 0.4725000000
block create brick 0.5000000000 0.7500000000 0.1250000000 0.2500000000 0.4050000000 0.4725000000
block create brick 0.7500000000 1.0000000000 0.1250000000 0.2500000000 0.4050000000 0.4725000000
block create brick 0.0000000000 0.2500000000 0.0000000000 0.1250000000 0.5400000000 0.6075000000
block create brick 0.2500000000 0.5000000000 0.0000000000 0.1250000000 0.5400000000 0.6075000000
block create brick 0.5000000000 0.7500000000 0.0000000000 0.1250000000 0.5400000000 0.6075000000
block create brick 0.7500000000 1.0000000000 0.0000000000 0.1250000000 0.5400000000 0.6075000000
block create brick 0.0000000000 0.1250000000 0.0000000000 0.2500000000 0.6075000000 0.6750000000
block create brick 0.1250000000 0.1875000000 0.0000000000 0.2500000000 0.6075000000 0.6750000000
block create brick 0.1875000000 0.3125000000 0.0000000000 0.2500000000 0.6075000000 0.6750000000
block create brick 0.3125000000 0.4375000000 0.0000000000 0.2500000000 0.6075000000 0.6750000000
block create brick 0.4375000000 0.5625000000 0.0000000000 0.2500000000 0.6075000000 0.6750000000
block create brick 0.5625000000 0.6875000000 0.0000000000 0.2500000000 0.6075000000 0.6750000000
block create brick 0.6875000000 0.8125000000 0.0000000000 0.2500000000 0.6075000000 0.6750000000
block create brick 0.8125000000 0.8750000000 0.0000000000 0.2500000000 0.6075000000 0.6750000000
block create brick 0.8750000000 1.0000000000 0.0000000000 0.2500000000 0.6075000000 0.6750000000
block create brick 0.0000000000 0.2500000000 0.1250000000 0.2500000000 0.5400000000 0.6075000000
block create brick 0.2500000000 0.5000000000 0.1250000000 0.2500000000 0.5400000000 0.6075000000
block create brick 0.5000000000 0.7500000000 0.1250000000 0.2500000000 0.5400000000 0.6075000000
block create brick 0.7500000000 1.0000000000 0.1250000000 0.2500000000 0.5400000000 0.6075000000
block create brick 0.0000000000 0.2500000000 0.0000000000 0.1250000000 0.6750000000 0.7425000000
block create brick 0.2500000000 0.5000000000 0.0000000000 0.1250000000 0.6750000000 0.7425000000
block create brick 0.5000000000 0.7500000000 0.0000000000 0.1250000000 0.6750000000 0.7425000000
block create brick 0.7500000000 1.0000000000 0.0000000000 0.1250000000 0.6750000000 0.7425000000
block create brick 0.0000000000 0.1250000000 0.0000000000 0.2500000000 0.7425000000 0.8100000000
block create brick 0.1250000000 0.1875000000 0.0000000000 0.2500000000 0.7425000000 0.8100000000
block create brick 0.1875000000 0.3125000000 0.0000000000 0.2500000000 0.7425000000 0.8100000000
block create brick 0.3125000000 0.4375000000 0.0000000000 0.2500000000 0.7425000000 0.8100000000
block create brick 0.4375000000 0.5625000000 0.0000000000 0.2500000000 0.7425000000 0.8100000000
block create brick 0.5625000000 0.6875000000 0.0000000000 0.2500000000 0.7425000000 0.8100000000
block create brick 0.6875000000 0.8125000000 0.0000000000 0.2500000000 0.7425000000 0.8100000000
block create brick 0.8125000000 0.8750000000 0.0000000000 0.2500000000 0.7425000000 0.8100000000
block create brick 0.8750000000 1.0000000000 0.0000000000 0.2500000000 0.7425000000 0.8100000000
block create brick 0.0000000000 0.2500000000 0.1250000000 0.2500000000 0.6750000000 0.7425000000
block create brick 0.2500000000 0.5000000000 0.1250000000 0.2500000000 0.6750000000 0.7425000000
block create brick 0.5000000000 0.7500000000 0.1250000000 0.2500000000 0.6750000000 0.7425000000
block create brick 0.7500000000 1.0000000000 0.1250000000 0.2500000000 0.6750000000 0.7425000000
block create brick 0.0000000000 0.2500000000 0.0000000000 0.1250000000 0.8100000000 0.8775000000
block create brick 0.2500000000 0.5000000000 0.0000000000 0.1250000000 0.8100000000 0.8775000000
block create brick 0.5000000000 0.7500000000 0.0000000000 0.1250000000 0.8100000000 0.8775000000
block create brick 0.7500000000 1.0000000000 0.0000000000 0.1250000000 0.8100000000 0.8775000000
block create brick 0.0000000000 0.1250000000 0.0000000000 0.2500000000 0.8775000000 0.9450000000
block create brick 0.1250000000 0.1875000000 0.0000000000 0.2500000000 0.8775000000 0.9450000000
block create brick 0.1875000000 0.3125000000 0.0000000000 0.2500000000 0.8775000000 0.9450000000
block create brick 0.3125000000 0.4375000000 0.0000000000 0.2500000000 0.8775000000 0.9450000000
block create brick 0.4375000000 0.5625000000 0.0000000000 0.2500000000 0.8775000000 0.9450000000
block create brick 0.5625000000 0.6875000000 0.0000000000 0.2500000000 0.8775000000 0.9450000000
block create brick 0.6875000000 0.8125000000 0.0000000000 0.2500000000 0.8775000000 0.9450000000
block create brick 0.8125000000 0.8750000000 0.0000000000 0.2500000000 0.8775000000 0.9450000000
block create brick 0.8750000000 1.0000000000 0.0000000000 0.2500000000 0.8775000000 0.9450000000
block create brick 0.0000000000 0.2500000000 0.1250000000 0.2500000000 0.8100000000 0.8775000000
block create brick 0.2500000000 0.5000000000 0.1250000000 0.2500000000 0.8100000000 0.8775000000
block create brick 0.5000000000 0.7500000000 0.1250000000 0.2500000000 0.8100000000 0.8775000000
block create brick 0.7500000000 1.0000000000 0.1250000000 0.2500000000 0.8100000000 0.8775000000
block create brick 0.0000000000 0.2500000000 0.0000000000 0.1250000000 0.9450000000 1.0125000000
block create brick 0.2500000000 0.5000000000 0.0000000000 0.1250000000 0.9450000000 1.0125000000
block create brick 0.5000000000 0.7500000000 0.0000000000 0.1250000000 0.9450000000 1.0125000000
block create brick 0.7500000000 1.0000000000 0.0000000000 0.1250000000 0.9450000000 1.0125000000
block create brick 0.0000000000 0.1250000000 0.0000000000 0.2500000000 1.0125000000 1.0800000000
block create brick 0.1250000000 0.1875000000 0.0000000000 0.2500000000 1.0125000000 1.0800000000
block create brick 0.1875000000 0.3125000000 0.0000000000 0.2500000000 1.0125000000 1.0800000000
block create brick 0.3125000000 0.4375000000 0.0000000000 0.2500000000 1.0125000000 1.0800000000
block create brick 0.4375000000 0.5625000000 0.0000000000 0.2500000000 1.0125000000 1.0800000000
block create brick 0.5625000000 0.6875000000 0.0000000000 0.2500000000 1.0125000000 1.0800000000
block create brick 0.6875000000 0.8125000000 0.0000000000 0.2500000000 1.0125000000 1.0800000000
block create brick 0.8125000000 0.8750000000 0.0000000000 0.2500000000 1.0125000000 1.0800000000
block create brick 0.8750000000 1.0000000000 0.0000000000 0.2500000000 1.0125000000 1.0800000000
block create brick 0.0000000000 0.2500000000 0.1250000000 0.2500000000 0.9450000000 1.0125000000
block create brick 0.2500000000 0.5000000000 0.1250000000 0.2500000000 0.9450000000 1.0125000000
block create brick 0.5000000000 0.7500000000 0.1250000000 0.2500000000 0.9450000000 1.0125000000
block create brick 0.7500000000 1.0000000000 0.1250000000 0.2500000000 0.9450000000 1.0125000000
block create brick 0.0000000000 0.2500000000 0.0000000000 0.1250000000 1.0800000000 1.1475000000
block create brick 0.2500000000 0.5000000000 0.0000000000 0.1250000000 1.0800000000 1.1475000000
block create brick 0.5000000000 0.7500000000 0.0000000000 0.1250000000 1.0800000000 1.1475000000
block create brick 0.7500000000 1.0000000000 0.0000000000 0.1250000000 1.0800000000 1.1475000000
block create brick 0.0000000000 0.1250000000 0.0000000000 0.2500000000 1.1475000000 1.2150000000
block create brick 0.1250000000 0.1875000000 0.0000000000 0.2500000000 1.1475000000 1.2150000000
block create brick 0.1875000000 0.3125000000 0.0000000000 0.2500000000 1.1475000000 1.2150000000
block create brick 0.3125000000 0.4375000000 0.0000000000 0.2500000000 1.1475000000 1.2150000000
block create brick 0.4375000000 0.5625000000 0.0000000000 0.2500000000 1.1475000000 1.2150000000
block create brick 0.5625000000 0.6875000000 0.0000000000 0.2500000000 1.1475000000 1.2150000000
block create brick 0.6875000000 0.8125000000 0.0000000000 0.2500000000 1.1475000000 1.2150000000
block create brick 0.8125000000 0.8750000000 0.0000000000 0.2500000000 1.1475000000 1.2150000000
block create brick 0.8750000000 1.0000000000 0.0000000000 0.2500000000 1.1475000000 1.2150000000
block create brick 0.0000000000 0.2500000000 0.1250000000 0.2500000000 1.0800000000 1.1475000000
block create brick 0.2500000000 0.5000000000 0.1250000000 0.2500000000 1.0800000000 1.1475000000
block create brick 0.5000000000 0.7500000000 0.1250000000 0.2500000000 1.0800000000 1.1475000000
block create brick 0.7500000000 1.0000000000 0.1250000000 0.2500000000 1.0800000000 1.1475000000
block create brick 0.0000000000 0.2500000000 0.0000000000 0.1250000000 1.2150000000 1.2825000000
block create brick 0.2500000000 0.5000000000 0.0000000000 0.1250000000 1.2150000000 1.2825000000
block create brick 0.5000000000 0.7500000000 0.0000000000 0.1250000000 1.2150000000 1.2825000000
block create brick 0.7500000000 1.0000000000 0.0000000000 0.1250000000 1.2150000000 1.2825000000
block create brick 0.0000000000 0.1250000000 0.0000000000 0.2500000000 1.2825000000 1.3500000000
block create brick 0.1250000000 0.1875000000 0.0000000000 0.2500000000 1.2825000000 1.3500000000
block create brick 0.1875000000 0.3125000000 0.0000000000 0.2500000000 1.2825000000 1.3500000000
block create brick 0.3125000000 0.4375000000 0.0000000000 0.2500000000 1.2825000000 1.3500000000
block create brick 0.4375000000 0.5625000000 0.0000000000 0.2500000000 1.2825000000 1.3500000000
block create brick 0.5625000000 0.6875000000 0.0000000000 0.2500000000 1.2825000000 1.3500000000
block create brick 0.6875000000 0.8125000000 0.0000000000 0.2500000000 1.2825000000 1.3500000000
block create brick 0.8125000000 0.8750000000 0.0000000000 0.2500000000 1.2825000000 1.3500000000
block create brick 0.8750000000 1.0000000000 0.0000000000 0.2500000000 1.2825000000 1.3500000000
block create brick 0.0000000000 0.2500000000 0.1250000000 0.2500000000 1.2150000000 1.2825000000
block create brick 0.2500000000 0.5000000000 0.1250000000 0.2500000000 1.2150000000 1.2825000000
block create brick 0.5000000000 0.7500000000 0.1250000000 0.2500000000 1.2150000000 1.2825000000
block create brick 0.7500000000 1.0000000000 0.1250000000 0.2500000000 1.2150000000 1.2825000000
;block create brick 0.0000000000 1.0000000000 0.0000000000 0.2500000000 -0.0065000000 0.0000000000
;block create brick 0.0000000000 1.0000000000 0.0000000000 0.2500000000 1.3500000000 1.3565000000

fish def select_rows1
    group_name = 'Odd_rows'
    z_lim = 1.35
    block_height = 0.0675
    z_upper = block_height
    z_lower = 0
    loop while z_upper < z_lim
        command
            block group [group_name] range pos-z [z_lower] [z_upper]
        endcommand
        z_lower = z_lower + 2*block_height
        z_upper = z_upper + 2*block_height
    endloop
end
[select_rows1]


block cut joint-set dip 90 dip-direction 90 origin 0.500 0 0
block group 'B1' range pos-x 0.45 0.55

block cut joint-set dip 90 dip-direction 90 origin 0.375 0 0
block group 'B2' range pos-x 0.32 0.42
block hide range group 'B1'
block hide range group 'B2'

block group 'B31' range position (0.28, 0, 0) (0.48, 0.125, 1.35)
block group 'B32' range position (0.28, 0.125, 0) (0.48, 0.25, 1.35)

block cut joint-set dip 90 dip-direction 90 origin 0.63 0 0
block group 'B2' range pos-x 0.58 0.68
block hide range group 'B2'
block group 'B41' range position (0.51, 0, 0) (0.72, 0.125, 1.35)
block group 'B42' range position (0.51, 0.125, 0) (0.72, 0.25, 1.35)

block cut joint-set dip 90 dip-direction 90 origin 0.125 0 0
block group 'B51' range position (0, 0, 0) (0.25, 0.125, 1.35) group 'Odd_rows'
block group 'B52' range position (0, 0.125, 0) (0.25, 0.25, 1.35) group 'Odd_rows'

block cut joint-set dip 90 dip-direction 90 origin 0.875 0 0
block group 'B61' range position (0.75, 0, 0) (1, 0.125, 1.35) group 'Odd_rows'
block group 'B62' range position (0.75, 0.125, 0) (1, 0.25, 1.35) group 'Odd_rows'

block hide off

block create brick 0 1 0.00 0.25 +1.35 1.40 group 'TOP'
block create brick 0 1 0.00 0.25 -0.05 0.00 group 'BOT'
;block delete range pos-y 0.125 100

;block face triangulate radial-8
block face triangulate edge-max 0.05  ;Use this for finer discretization
;block group 'BOT' range pos-z -0.00650000 0.00000000
;block group 'TOP' range pos-z 1.35000000 1.35650000

;BOUNDARY CONDITION
block fix range group 'BOT'

;MATERAIL PROPERTIES
block property density 1652

;CONTACT PROPERTIES
;E and G are not enlarged.
block contact generate-subcontacts
block contact jmodel assign example
block contact property stiffness-normal 22938461538.461536 stiffness-shear 7692307692.307692 ...
ten 40000.0 cohesion 230000.0 fric 34.99202020 ...
fric-residual 34.99202020 cohesion-residual 0  ...
Gf_tension 1.16 Gf_shear 11.6 Gc_compression 5000 fc 3100000.0


fish def apply_properties
    group_list = list.sequence('B1', 'B2', 'B31', 'B32', 'B41', 'B42', 'B51', 'B52', 'B61', 'B62')
    loop foreach local group_name group_list
        command
            block contact property stiffness-normal 22938461538.461536 stiffness-shear 7692307692.307692 ...
                    ten 1e6 cohesion 1.4e6 fric 35 ...
                    fric-residual 35 cohesion-residual 0  ...
                    Gf_tension 30 Gf_shear 300 Gc_compression 5000 fc 3100000.0 range group-intersection [group_name] [group_name]
        endcommand
    endloop
end
[apply_properties]


;block contact property stiffness-normal 22938461538.461536 stiffness-shear 7692307692.307692 ...
;ten 1e6 cohesion 1.4e6 fric 35 ...
;fric-residual 35 cohesion-residual 0  ...
;Gf_tension 30 Gf_shear 300 Gc_compression 5000 fc 3100000.0 range group-intersection 'B1' 'B1'
;
;block contact property stiffness-normal 22938461538.461536 stiffness-shear 7692307692.307692 ...
;ten 1e6 cohesion 1.4e6 fric 35 ...
;fric-residual 35 cohesion-residual 0  ...
;Gf_tension 30 Gf_shear 300 Gc_compression 5000 fc 3100000.0 range group-intersection 'B2' 'B2'
;
;block contact property stiffness-normal 22938461538.461536 stiffness-shear 7692307692.307692 ...
;ten 1e6 cohesion 1.4e6 fric 35 ...
;fric-residual 35 cohesion-residual 0  ...
;Gf_tension 30 Gf_shear 300 Gc_compression 5000 fc 3100000.0 range group-intersection 'B3' 'B3'
;
;block contact property stiffness-normal 22938461538.461536 stiffness-shear 7692307692.307692 ...
;ten 1e6 cohesion 1.4e6 fric 35 ...
;fric-residual 35 cohesion-residual 0  ...
;Gf_tension 30 Gf_shear 300 Gc_compression 5000 fc 3100000.0 range group-intersection 'B4' 'B4'

;block contact property stiffness-normal 22938461538.461536 stiffness-shear 7692307692.307692 ...
;ten 40000.0 cohesion 23000000.0 fric 44.00000000 ...
;fric-residual 44.00000000 cohesion-residual 0    ...
;Gf_tension 1.16 Gf_shear 1160.0 Gc_compression 5000 fc 3100000.0 range group-intersection 'TOP' 'None'

;block contact property stiffness-normal 22938461538.461536 stiffness-shear 7692307692.307692 ...
;ten 40000.0 cohesion 23000000.0 fric 44.00000000 ...
;fric-residual 44.00000000 cohesion-residual 0 ...
;Gf_tension 1.16 Gf_shear 1160.0 Gc_compression 5000 fc 3100000.0 range group-intersection 'BOT' 'None'

;Select face for vertical pressure
block face group 'TOPFACE' range pos-z 1.399 1.41

; Definition of necessary functions used
fish def dump
    Gp_information = list
    Column_names = list
    Column_names('end') = 'Block_ID Grid_point_ID Pos_x Pos_y Pos_z Disp_x Disp_y Disp_z'
    loop foreach bgpp block.gp.list
        blp = block.gp.hostblock(bgpp)
        block_i = block.id(blp)
        gp_i = block.gp.id(bgpp)
        pos = block.gp.pos(bgpp)
        disp = block.gp.disp(bgpp)
        Gp_information('end') = string(block_i) + ' ' +string(gp_i) + ' ' ...
                + string(pos->x)+' '+string(pos->y)+' '+string(pos->z) + ' ' ...
                + string(disp->x)+' '+string(disp->y)+' '+string(disp->z)
    end_loop
    file.open('Gp_info_cyclic_crack_length','write','text')
    file.write(Column_names)
    file.write(Gp_information)
    file.close
end

;;Pushover test function
;fish define test
;    top_gp = block.gp.near(0.50000000, 0.12500000, 1.4)
;    top_dis = math.abs(block.gp.disp.x(top_gp))
;    cycle_n = 1000
;    velocity = 0.005
;    block_group = 'TOP'
;    amp = 0.007
;    command
;        block apply velocity-x [velocity] range group [block_group]
;    endcommand
;    ;Keep cycling until the amplitude is reached
;    loop while top_dis < amp
;        command
;            model cycle [cycle_n]
;        endcommand
;        top_dis = math.abs(block.gp.disp.x(top_gp))
;    endloop
;    command
;        [dump]
;    endcommand
;end

;Cyclic test function
fish define test
    top_gp = block.gp.near(0.50000000, 0.12500000, 1.4)
    top_dis = math.abs(block.gp.disp.x(top_gp))
    disp_amp = list.seq(0.00025000, 0.00025000, 0.00050000, 0.00050000, 0.00075000, 0.00075000, 0.00100000, 0.00100000, 0.00125000, 0.00125000, 0.00150000, 0.00150000, 0.00175000, 0.00175000, 0.00200000, 0.00200000, 0.00225000, 0.00225000, 0.00250000, 0.00250000, 0.00275000, 0.00275000, 0.00300000, 0.00300000, 0.00325000, 0.00325000, 0.00350000, 0.00350000, 0.00375000, 0.00375000, 0.00400000, 0.00400000, 0.00425000, 0.00425000, 0.00450000, 0.00450000, 0.00475000, 0.00475000, 0.00500000, 0.00500000, 0.00525000, 0.00525000, 0.00550000, 0.00550000, 0.00575000, 0.00575000, 0.00600000, 0.00600000, 0.00625000, 0.00625000, 0.00650000, 0.00650000, 0.00675000, 0.00675000, 0.00700000, 0.00700000)
    cycle_n = 100
    velocity = 0.01
    block_group = 'TOP'
    v_sign = 1

    loop foreach amp disp_amp
        ;Initialize the velocity and immediately cycle it without checking.
        ;This assumes that the limit in displacement is not exceeded by the first cycle_n cycles
        command
            block apply velocity-x [velocity * v_sign] range group [block_group]
            model cycle [2*cycle_n]
        endcommand
        top_dis = math.abs(block.gp.disp.x(top_gp))
        ;Keep cycling until the amplitude is reached
        loop while top_dis < amp
            command
                model cycle [cycle_n]
            endcommand
            top_dis = math.abs(block.gp.disp.x(top_gp))
        endloop
        v_sign = -v_sign
    end_loop
    ; Return the block to the zero displacement location
    top_dis = block.gp.disp.x(top_gp)
    command
        block apply velocity-x [velocity * v_sign] range group [block_group]
        model cycle [cycle_n]
    endcommand
    loop while top_dis < 0
        command
            model cycle [cycle_n]
        endcommand
        top_dis = block.gp.disp.x(top_gp)
    endloop
    command
        [dump]
    endcommand
end

;History fish functions
block contact group-subcontact 'Bot_boundary' range pos-z -0.01 +0.01
fish def Reaction_shear
    top_shear = 0
    loop foreach bscp block.subcontact.list
        if block.subcontact.group(bscp) = 'Bot_boundary'
            top_shear = top_shear + block.subcontact.force.shear.x(bscp)
        endif
    end_loop
    Reaction_shear = top_shear
end
fish history Reaction_shear


fish def Reaction_normal
    top_normal = 0
    loop foreach bscp block.subcontact.list
        if block.subcontact.group(bscp) = 'Bot_boundary'
            top_normal = top_normal + block.subcontact.force.norm(bscp)
        endif
    end_loop
    Reaction_normal = top_normal
end
fish history Reaction_normal



;Record history
block history displacement-x position 0.5 0 1.4
[Reaction_normal]
[Reaction_shear]

; These two below are for the evolution of crack opening at mid height.
block history displacement-x gridpointid 11095
block history displacement-x gridpointid 5281

;Apply gravity
model gravity 0 0 -9.81
model solve

;Apply vertical load to settle the model.
block face apply stress-zz -600000.0 range group 'TOPFACE'  ; Select the top face.
model solve
block fix range group 'TOP'

;Apply loading
[test]

model save 'cyclic_crack_length'